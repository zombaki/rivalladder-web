<div class="ladder-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>leaderboard</mat-icon>
        <span>Club Ladder Rankings</span>
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div *ngIf="loading$ | async" class="loading-container">
        <mat-spinner></mat-spinner>
      </div>

      <table mat-table [dataSource]="(ladderEntries$ | async) || []" class="ladder-table" *ngIf="!(loading$ | async)">
        <!-- Rank Column -->
        <ng-container matColumnDef="rank">
          <th mat-header-cell *matHeaderCellDef>Rank</th>
          <td mat-cell *matCellDef="let entry">
            <div [class]="getRankBadgeClass(entry.rank)">
              {{ entry.rank }}
            </div>
          </td>
        </ng-container>

        <!-- Player Column -->
        <ng-container matColumnDef="player">
          <th mat-header-cell *matHeaderCellDef>Player</th>
          <td mat-cell *matCellDef="let entry">
            <div class="player-info">
              <img 
                [src]="entry.user?.photoUrl || 'assets/default-avatar.png'" 
                alt="Player photo"
                class="user-avatar"
              />
              <div class="player-details">
                <span class="player-name">{{ entry.user?.firstName }} {{ entry.user?.lastName }}</span>
                <span class="player-points">{{ entry.points }} pts</span>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Stats Column -->
        <ng-container matColumnDef="stats">
          <th mat-header-cell *matHeaderCellDef>Record</th>
          <td mat-cell *matCellDef="let entry">
            <div class="stats">
              <mat-chip-set>
                <mat-chip class="wins-chip">{{ entry.wins }}W</mat-chip>
                <mat-chip class="losses-chip">{{ entry.losses }}L</mat-chip>
              </mat-chip-set>
              <span class="win-percentage">{{ getWinPercentage(entry.wins, entry.losses) }}%</span>
            </div>
          </td>
        </ng-container>

        <!-- Streak Column -->
        <ng-container matColumnDef="streak">
          <th mat-header-cell *matHeaderCellDef>Streak</th>
          <td mat-cell *matCellDef="let entry">
            <mat-chip *ngIf="entry.winStreak > 0" class="streak-chip">
              <mat-icon>whatshot</mat-icon>
              {{ entry.winStreak }}
            </mat-chip>
            <span *ngIf="entry.winStreak === 0">-</span>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Action</th>
          <td mat-cell *matCellDef="let entry">
            <button 
              mat-raised-button 
              color="primary"
              (click)="challengePlayer(entry)"
              [disabled]="!canChallenge(entry, (currentUser$ | async)?.id)"
              matTooltip="Challenge this player"
            >
              <mat-icon>sports</mat-icon>
              Challenge
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <div *ngIf="!(loading$ | async) && ((ladderEntries$ | async)?.length === 0)" class="empty-state">
        <mat-icon>info</mat-icon>
        <p>No players in the ladder yet. Be the first to join!</p>
      </div>
    </mat-card-content>
  </mat-card>
</div>
